<html>
    <head>
      <script src="./gml2d.js" type="text/javascript"></script>
      <title>Polygon Convexity Inspector</title>
    </head>
    <body onload="init()">
    <script type="text/javascript">
        var canvas;
        var context;
        var poly;

        function init() {
            canvas = document.getElementById( "viewport" );
            context = canvas.getContext( '2d' );

            var MAX_POLY_VERTS = 20;

            poly = { points: [] };

            genPoly( Math.random() * ( MAX_POLY_VERTS - 3 ) + 3, false );

            visualizePoly( poly );
        }

        function genPoly( sides, regular ) {
            var points = [];

            if ( regular ) {
                var r = 100;
                var cx = canvas.width / 2;
                var cy = canvas.height / 2;
                for ( var i = 0; i < sides; i++ ) {
                    points.push( new gml2d.Vec2( Math.cos( ( i / sides ) * 2 * Math.PI ) * r + cx
                                               , Math.sin( ( i / sides ) * 2 * Math.PI ) * r + cy ) );
                }
            } else {
                for ( var i = 0; i < sides; i++ ) {
                    points.push( new gml2d.Vec2( Math.random() * canvas.width
                                               , Math.random() * canvas.height ) );
                }
            }

            poly.points = points
        }

        function visualizePoly( poly ) {
            context.beginPath();
            context.moveTo( poly.points[0].x, poly.points[0].y );
            context.lineWidth = 1;
            context.fillStyle = gml2d.convex( poly ) ? 'green' : 'red';

            for ( var i = 0; i < poly.points.length; i++ ) {
                var p = poly.points[ (i+1) % poly.points.length ];
                context.lineTo( p.x, p.y );
            }

            context.fill();
            context.stroke();
        }
    </script>
    <div role="main" id="maincolumn">
      <center>
        <div id="screen">
          <canvas id="viewport" height="500" width="500">
          </canvas>
        </div>
      </center>
    </div>
    </body>
</html>
